import{load,_}from"assets://js/lib/cat.js";let key="爱上你听书网",HOST="https://wap.230ts.net",siteKey="",siteType=0;const MOBILE_UA="Mozilla/5.0 (Linux; Android 11; M2007J3SC Build/RKQ1.200826.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/77.0.3865.120 MQQBrowser/6.2 TBS/045714 Mobile Safari/537.36";async function request(reqUrl,agentSp){return(await req(reqUrl,{method:"get",headers:{"User-Agent":agentSp||MOBILE_UA,Referer:HOST}})).content}async function init(cfg){siteKey=cfg.skey,siteType=cfg.stype}async function home(filter){var html=await request(HOST+"/sort/"),html=load(html)("dl.pd-class:first > dd > a[href*=sort]"),html=_.map(html,cls=>{let typeId=cls.attribs.href;return{type_id:typeId=typeId.replace(/.*?\/sort\/(.*).html/g,"$1"),type_name:cls.children[0].data}});const sortName=["玄幻有声","灵异有声","综艺娱乐","长篇评书","都市有声","军事有声","职场有声","其他有声"];return html=_.sortBy(html,c=>{c=sortName.indexOf(c.type_name);return-1===c?sortName.length:c}),JSON.stringify({class:html,filters:{}})}async function homeVod(){var html=await request(HOST+"/top/lastupdate/1.html");const $=load(html);html=$("ul.list-ul > li"),html=_.map(html,item=>{var it=$(item).find("a:first")[0],img=$(item).find("img:first")[0],item=$($(item).find("p.module-slide-author")[0]).text().trim();return{vod_id:it.attribs.href.replace(/.*?\/tingshu\/(.*)/g,"$1"),vod_name:it.attribs.title.replace("有声小说",""),vod_pic:HOST+img.attribs["data-original"],vod_remarks:item||""}});return JSON.stringify({list:html})}async function category(tid,pg,filter,extend){pg<=0&&(pg=1);tid=await request(HOST+"/sort/"+tid+"/"+pg+".html");const $=load(tid);var tid=$("ul.book-ol > li"),tid=_.map(tid,item=>{var it=$(item).find("a:first")[0],img=$(item).find("img:first")[0],item=$($(item).find("div.book-meta")[0]).text().trim();return{book_id:it.attribs.href.replace(/.*?\/tingshu\/(.*)/g,"$1"),book_name:it.attribs.title.replace("有声小说",""),book_pic:HOST+img.attribs["data-original"],book_remarks:item.replace("佚名（著）","").replace("佚名（播）","").replace("未知（著）","").replace("未知（播）","")||""}}),pgCount=0<$("div.paging > a:contains(下一页)").length?parseInt(pg)+1:parseInt(pg);return JSON.stringify({page:parseInt(pg),pagecount:pgCount,limit:24,total:24*pgCount,list:tid})}async function detail(id){var html=await request(HOST+"/tingshu/"+id),html=load(html),id=(html("div.book-cell:first > div"),{book_id:id,type_name:html("h1:first").text().trim().replace("有声小说",""),book_year:"",book_area:"",book_remarks:"",book_actor:"",book_director:"",book_content:""}),html=_.map(html("#playlist > ul > li > a"),it=>it.children[0].data+"$"+it.attribs.href.replace(/\/mp3\/(.*).html/g,"$1")).join("#");return id.volumes="道长在线",id.urls=html,JSON.stringify({list:[id]})}async function play(flag,id,flags){var id=HOST+"/mp3/"+id+".html",html=await request(id),html=load(html)("body iframe[src*=player]");const iframeHtml=(await req(HOST+html[0].attribs.src,{headers:{Referer:id,"User-Agent":MOBILE_UA}})).content,playUrl=iframeHtml.match(/mp3:'(.*?)'/)[1];if(0<=playUrl.indexOf("m4a")||0<=playUrl.indexOf("mp3"))return JSON.stringify({parse:0,url:playUrl});try{const iframeHtml=(await req(HOST+html[0].attribs.src,{headers:{Referer:id,"User-Agent":MOBILE_UA}})).content,playUrl=playUrl+".m4a"+iframeHtml.match(/(\?.*?)'/)[1];if(0<=playUrl.indexOf("http"))return JSON.stringify({parse:0,url:playUrl});{const iframeHtml=(await req(HOST+html[0].attribs.src,{headers:{Referer:id,"User-Agent":MOBILE_UA}})).content;var playUrl3,playUrl2=iframeHtml.match(/url[\s\S]*?(http.*?)'/)[1];return 0<=playUrl2.indexOf("?")?JSON.stringify({parse:0,url:playUrl2}):(playUrl3=playUrl2+playUrl,JSON.stringify({parse:0,url:playUrl3}))}}catch(e){}if(0<=playUrl.indexOf("http")){const playUrl=playUrl+".m4a";return JSON.stringify({parse:0,url:playUrl})}{const iframeHtml=(await req(HOST+html[0].attribs.src,{headers:{Referer:id,"User-Agent":MOBILE_UA}})).content;playUrl2=iframeHtml.match(/url[\s\S]*?(http.*?)'/)[1];return JSON.stringify({parse:0,url:playUrl2+".m4a"})}}async function search(wd,quick){wd=await request(HOST+"/search.html?searchtype=name&searchword="+wd+"&page=1");const $=load(wd);wd=$("ul.book-ol > li"),wd=_.map(wd,item=>{var it=$(item).find("a:first")[0],img=$(item).find("img:first")[0],item=$($(item).find("div.book-meta")[0]).text().trim();return{book_id:it.attribs.href.replace(/.*?\/tingshu\/(.*)/g,"$1"),book_name:it.attribs.title.replace("有声小说",""),book_pic:img.attribs["data-original"],book_remarks:item.replace("佚名（著）","").replace("佚名（播）","").replace("未知（著）","").replace("未知（播）","")||""}});return JSON.stringify({list:wd})}function __jsEvalReturn(){return{init:init,home:home,homeVod:homeVod,category:category,detail:detail,play:play,search:search}}export{__jsEvalReturn};