import{Crypto,_,load}from"assets://js/lib/cat.js";let key="baozimh",url="https://cn.baozimh.com";const img="https://static-tw.baozimh.com/cover/",img2="?w=285&h=375&q=100";let siteKey="",siteType=0;const UA="Mozilla/5.0 (Linux; Android 11; M2007J3SC Build/RKQ1.200826.002; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/77.0.3865.120 MQQBrowser/6.2 TBS/045714 Mobile Safari/537.36";async function request(reqUrl){return(await req(reqUrl,{headers:{"User-Agent":UA}})).content}async function init(cfg){siteKey=cfg.skey,siteType=cfg.stype}async function home(filter){var html=await request(url+"/classify"),$=load(html),filterObj={c1:[]};for(const nav of $("div.classify div.nav")){var as=$(nav).find("a.item"),reg=/type=(.*)&region=(.*)&state=(.*)&filter=(.*)/,matchs=decodeURIComponent(as[1].attribs.href).match(reg);let typeKey="",typeIdx=1;"all"!=matchs[1]?(typeKey="type",typeIdx=1):"all"!=matchs[2]?(typeKey="region",typeIdx=2):"all"!=matchs[3]?(typeKey="state",typeIdx=3):"*"!=matchs[4]&&(typeKey="filter",typeIdx=4);var tvals=[];for(const a of as)tvals.push({n:$(a).text().trim(),v:decodeURIComponent(a.attribs.href).match(reg)[typeIdx]});filterObj.c1.push({key:typeKey,name:"",wrap:1==typeIdx?1:0,init:4==typeIdx?"*":"all",value:tvals})}return{class:[{type_name:"all",type_id:"c1"}],filters:filterObj}}async function category(tid,pg,filter,extend){0==pg&&(pg=1);var extend=`${url}/api/bzmhq/amp_comic_list?type=${extend.type||"all"}&region=${extend.region||"all"}&state=${extend.state||"all"}&filter=`+(extend.filter||"*"),extend=await request(extend+="&page="+pg+"&limit=36&language=cn"),books=[];for(const book of JSON.parse(extend).items)books.push({book_id:book.comic_id,book_name:book.name,book_pic:img+book.topic_img+img2,book_remarks:book.author||""});return{page:pg,pagecount:36==books.length?pg+1:pg,list:books}}async function detail(id){id=await request(url+"/comic/"+id);const $=load(id);var id={book_director:$("[data-hid$=og:novel:author]")[0].attribs.content||"",book_content:$("[data-hid$=og:description]")[0].attribs.content||""},formatUrl=a=>$(a).text().replace(/\$|#/g," ").trim()+"$"+decodeURIComponent(a.attribs.href);let urls=_.map($("div#chapter-items a.comics-chapters__item"),formatUrl);return urls.push(..._.map($("div#chapters_other_list a.comics-chapters__item"),formatUrl)),0==urls.length&&(urls=_.reverse(_.map($("div.pure-g a.comics-chapters__item"),formatUrl))),id.volumes="默認",id.urls=urls.join("#"),{list:[id]}}async function play(flag,id,flags){try{var html=await request(url+id),$=load(html),content=[];for(const img of $("amp-img"))content.push(img.attribs.src);return{content:content}}catch(e){}return{content:[]}}async function search(wd,quick,pg){var wd=await request(url+"/search?q="+wd),$=load(wd),books=[];for(const a of $("div.classify-items a.comics-card__poster"))books.push({book_id:a.attribs.href.replace("/comic/",""),book_name:a.attribs.title,book_pic:$(a).find("amp-img:first")[0].attribs.src,book_remarks:""});return{page:1,pagecount:1,list:books}}function __jsEvalReturn(){return{init:init,home:home,category:category,detail:detail,play:play,search:search}}export{__jsEvalReturn};