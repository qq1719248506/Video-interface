import{_}from"assets://js/lib/cat.js";import{log}from"./lib/utils.js";import{initAli,detailContent,playContent}from"./lib/ali.js";let siteKey="dovx",siteType=0,siteUrl="https://api.dovx.tk",patternAli=/(https:\/\/www\.(aliyundrive|alipan)\.com\/s\/[^"]+)/;async function request(reqUrl){return(await req(reqUrl,{method:"get",headers:{Referer:siteUrl}})).content}async function init(cfg){try{siteKey=_.isEmpty(cfg.skey)?"":cfg.skey,siteType=_.isEmpty(cfg.stype)?"":cfg.stype,await initAli(cfg)}catch(e){await log("init:"+e.message+" line:"+e.lineNumber)}}async function home(filter){return"{}"}async function homeVod(){}async function category(tid,pg,filter,extend){return"{}"}async function detail(id){try{var matches=id.match(patternAli);return _.isEmpty(matches)?"":await detailContent(matches[0])}catch(e){await log("detail:"+e.message+" line:"+e.lineNumber)}}async function play(flag,id,flags){try{return await playContent(flag,id,flags)}catch(e){await log("play:"+e.message+" line:"+e.lineNumber)}}async function search(wd,quick,pg){wd=await request(siteUrl+"/ali/search?wd="+encodeURIComponent(wd)),wd=JSON.parse(wd).list;return _.each(wd,item=>{item.vod_id=item.vod_content,item.vod_content=void 0}),JSON.stringify({list:wd})}function __jsEvalReturn(){return{init:init,home:home,homeVod:homeVod,category:category,detail:detail,play:play,search:search}}export{__jsEvalReturn};