import{Crypto,load,_}from"assets://js/lib/cat.js";let url="",siteKey="",siteType=0;const UA="Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1",cookie={};async function request(reqUrl,referer,mth,data,hd){var headers={"User-Agent":UA,"X-CLIENT":"open",Cookie:_.map(cookie,(value,key)=>key+"="+value).join(";")},referer=(referer&&(headers.referer=encodeURIComponent(referer)),await req(reqUrl,{method:mth||"get",headers:headers,data:data,postType:"post"===mth?"form":""}));return referer.content}async function init(cfg){siteKey=cfg.skey,siteType=cfg.stype,url=cfg.ext}async function home(filter){return(await request(url)).replaceAll("1$/$1","1$/$0")}async function homeVod(){return"{}"}async function category(tid,pg,filter,extend){pg<=0&&(pg=1);let api=url+"?t="+tid+"&pg="+pg;return extend&&(tid=Object.entries(extend).map(([key,val]=entry)=>"&"+key+"="+val),api=(api+=tid)+("&f="+encodeURIComponent(JSON.stringify(extend)))),request(api)}async function detail(id){return request(url+"?ids="+id)}async function play(flag,id,flags){var js2Base=await js2Proxy(!0,siteType,siteKey,"dash/",{});return JSON.stringify({parse:0,url:js2Base+id,header:{Referer:"https://www.bilibili.com","User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/115.0.0.0 Safari/537.36"}})}async function search(wd,quick){return request(url+"?wd="+wd)}async function proxy(segments){var what=segments[0],segments=segments[1];return"dash"==what?(what=await request(url.replace("/bilibili","/play")+"?bvid="+segments+"&from=open&flag=proxy"),segments=JSON.parse(what),JSON.stringify({code:200,content:segments.mpd,headers:{"Content-Type":"application/dash+xml"}})):JSON.stringify({code:500,content:""})}function __jsEvalReturn(){return{init:init,home:home,homeVod:homeVod,category:category,detail:detail,play:play,proxy:proxy,search:search}}export{__jsEvalReturn};