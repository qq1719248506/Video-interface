import{load,_}from"assets://js/lib/cat.js";import{log}from"./lib/utils.js";import{initAli,detailContent,playContent}from"./lib/ali.js";let siteKey="xiaozhitiao",siteType=0,siteUrl="https://gitcafe.net/tool/alipaper/",aliUrl="https://www.aliyundrive.com/s/",token="",date=new Date;const UA="Mozilla/5.0 (iPhone; CPU iPhone OS 13_2_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/13.0.3 Mobile/15E148 Safari/604.1";async function request(reqUrl,data){return(await req(reqUrl,{method:"post",headers:{"User-Agent":UA},data:data,postType:"form"})).content}async function init(cfg){try{siteKey=_.isEmpty(cfg.skey)?"":cfg.skey,siteType=_.isEmpty(cfg.stype)?"":cfg.stype,await initAli(cfg)}catch(e){await log("init:"+e.message+" line:"+e.lineNumber)}}async function home(filter){return"{}"}async function homeVod(){}async function category(tid,pg,filter,extend){return"{}"}async function detail(id){try{return await detailContent(id)}catch(e){await log("detail:"+e.message+" line:"+e.lineNumber)}}async function play(flag,id,flags){try{return await playContent(flag,id,flags)}catch(e){await log("play:"+e.message+" line:"+e.lineNumber)}}async function search(wd,quick,pg){pg<=0&&(pg=1);var pg={action:"search",from:"web",keyword:wd,token:await getToken()},wd=await request(siteUrl,pg),pg=JSON.parse(wd);return pg.success?(wd=_.map(pg.data,item=>({vod_id:aliUrl+item.alikey,vod_name:item.title,vod_pic:"https://www.lgstatic.com/i/image2/M01/15/7E/CgoB5lysLXCADg6ZAABapAHUnQM321.jpg",vod_remarks:item.creatime})),JSON.stringify({list:wd})):""}async function getToken(){var params,newDate=new Date;return(_.isEmpty(token)||newDate>date)&&(params={action:"get_token"},params=await request(siteUrl,params),(params=JSON.parse(params)).success)&&(token=params.data,date=newDate),token}function __jsEvalReturn(){return{init:init,home:home,homeVod:homeVod,category:category,detail:detail,play:play,search:search}}export{__jsEvalReturn};